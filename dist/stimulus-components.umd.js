!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@hotwired/stimulus"),require("@rails/activestorage"),require("stimulus-use"),require("sortablejs"),require("uuid"),require("autosize")):"function"==typeof define&&define.amd?define(["exports","@hotwired/stimulus","@rails/activestorage","stimulus-use","sortablejs","uuid","autosize"],t):t((e||self).stimulusComponents={},e.Stimulus,e.activestorage,e.stimulusUse,e.sortablejs,e.uuid,e.autosize)}(this,function(e,t,r,i,n,a,o){function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=/*#__PURE__*/s(n),u=/*#__PURE__*/s(o);function c(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},d.apply(this,arguments)}function h(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,f(e,t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=0;function v(e){return"__private_"+m+++"_"+e}function g(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var b=/*#__PURE__*/function(){function e(e,t){var i=this;this.handleChange=function(e){i.options.onChangeFile(e)},this.handleProgress=function(e){i.handleChange({state:"uploading",file:i.directUpload.file,id:i.options.id,progress:e.loaded/e.total*100})},this.handleSuccess=function(e){return i.handleChange({state:"finished",id:i.options.id,file:i.directUpload.file,signedId:e}),e},this.handleError=function(e){throw i.handleChange({state:"error",id:i.options.id,file:i.directUpload.file,error:e}),e},this.directUpload=new r.DirectUpload(e,"/rails/active_storage/direct_uploads",this),this.options=t}var t=e.prototype;return t.start=function(){var e=this;return new Promise(function(t,r){e.directUpload.create(function(e,i){e?r(e):t(i.signed_id)})}).then(this.handleSuccess).catch(this.handleError)},t.directUploadWillCreateBlobWithXHR=function(e){this.options.onBeforeBlobRequest&&this.options.onBeforeBlobRequest({id:this.options.id,file:this.directUpload.file,xhr:e})},t.directUploadWillStoreFileWithXHR=function(e){this.options.onBeforeStorageRequest&&this.options.onBeforeStorageRequest({id:this.options.id,file:this.directUpload.file,xhr:e}),e.upload.addEventListener("progress",this.handleProgress)},e}(),y=/*#__PURE__*/function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).handleFileProgress=function(e){var r=document.querySelector('[data-temp-id="'+e.id+'"]');switch(e.state){case"uploading":r.querySelector(".progress-bar").style.width=e.progress+"%";break;case"error":r.remove(),t.setMessage("alert","Error uploading "+e.file.name+".");break;case"finished":r.querySelector(".upload-progress").remove();var i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("value",e.signedId),i.name=r.querySelector("input[name*='_destroy']").name.replace(/_destroy/g,"file"),r.appendChild(i),t.updateCount()}},t}h(t,e);var r,i,n=t.prototype;return n.handleFileClick=function(){if(this.hasMaxFilesValue&&this.activeFiles.length>=this.maxFilesValue)return this.setMessage("alert","Maximum files allowed: "+this.maxValue),!1;this.inputTarget.click()},n.handleNewFiles=function(e){try{var t=this,r=Array.from(e.target.files);return t.hasMaxFilesValue&&r.length+t.activeFiles.length>t.maxFilesValue?(t.setMessage("alert","Maximum files allowed: "+t.maxValue),Promise.resolve(!1)):Promise.resolve(Promise.all(r.map(function(e){return t.approveFile(e)}))).then(function(e){var r=e.filter(Boolean).map(function(e){return e});t.submitFiles(r),t.inputTarget.value=null})}catch(e){return Promise.reject(e)}},n.approveFile=function(e){try{var t,r=this;if(r.hasWhitelistValue&&!r.whitelistValue.includes(e.type))return r.setMessage("alert","Invalid file type: "+e.name),Promise.resolve(!1);if(r.hasmaxMbValue&&e.size>r.maxMb)return r.setMessage("alert","File size too large: "+e.name),Promise.resolve(!1);var i=function(){if(r.hasMaxDimensionValue)return Promise.resolve(r.getLargestDimension(e)).then(function(i){if(i>r.MaxDimensionValue)return r.setMessage("alert","Dimensions are too lage: "+e.name),t=1,!1})}();return Promise.resolve(i&&i.then?i.then(function(r){return t?r:e}):t?i:e)}catch(e){return Promise.reject(e)}},n.getLargestDimension=function(e){return new Promise(function(t){var r=new Image;r.src=URL.createObjectURL(e),r.onload=function(){var e=Math.max(r.width,r.height);URL.revokeObjectURL(r.src),t(e)}})},n.createAttachment=function(e){return this.element.nestedForm.addAssociation(e)},n.removeAttachment=function(e){this.element.nestedForm.removeAssociation(e),this.updateCount()},n.submitFiles=function(e){var t=this;e.forEach(function(e){var r=t.createAttachment();r.insertAdjacentHTML("beforeend",'\n        <div class="upload-progress">\n          <div class="progress-bar"></div>\n        </div>\n      '),r.querySelector(".filename").innerText=e.name,e.type.includes("image")&&r.querySelector("img")&&(r.querySelector("img").src=URL.createObjectURL(e)),new b(e,{id:r.dataset.tempId,onChangeFile:t.handleFileProgress}).start()})},n.updateCount=function(){this.hasCountTarget&&(this.countTarget.value=this.activeFiles.length)},n.setMessage=function(e,t){console.log(t)},r=t,(i=[{key:"activeFiles",get:function(){return this.fileTargets.filter(function(e){return!e.classList.contains("destroying")})}}])&&function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),t}(t.Controller);y.targets=["input","file","count","message"],y.values={maxFiles:Number,minFiles:Number,maxMb:Number,maxDimension:Number,whitelist:Array};var w=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var r=t.prototype;return r.connect=function(){i.useDebounce(this,{wait:this.debounceWaitValue})},r.submit=function(){this.formTarget.requestSubmit(),this.dispatch("submitted")},r.submitDebounced=function(){this.formTarget.requestSubmit(),this.dispatch("submitted")},r.clearInput=function(e){e.target.value=""},r.resetForm=function(){this.formTarget.reset()},r.clearForm=function(){var e=this.formTarget.elements,t=document.querySelectorAll('[form="'+this.formTarget.id+'"');[].concat(e,t).forEach(function(e){switch(e.type){case"checkbox":case"radio":e.checked=!1;break;default:e.value=""}})},r.addQueryString=function(e){var t=new URLSearchParams(new FormData(e.target));history.replaceState(null,null,"?"+t)},t}(t.Controller);w.debounces=["submitDebounced"],w.targets=["form"],w.values={debounceWait:{type:Number,default:150}};var x=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var r=t.prototype;return r.expandAll=function(){this.detailTargets.forEach(function(e){e.setAttribute("open",!0)}),this.dispatch("expanded-all")},r.collapseAll=function(){this.detailTargets.forEach(function(e){e.removeAttribute("open")}),this.dispatch("collapsed-all")},r.collapseOthers=function(e){this.detailTargets.forEach(function(t){t!==e.target&&t.removeAttribute("open")}),this.dispatch("collapsed-others")},t}(t.Controller);x.targets=["detail"];var T=/*#__PURE__*/v("findTemplate"),F=/*#__PURE__*/v("setContent"),S=/*#__PURE__*/v("approve"),j=/*#__PURE__*/v("activeItems"),P=/*#__PURE__*/function(e){function t(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return t=e.call.apply(e,[this].concat(i))||this,Object.defineProperty(p(t),j,{get:k,set:void 0}),Object.defineProperty(p(t),S,{value:C}),Object.defineProperty(p(t),F,{value:M}),Object.defineProperty(p(t),T,{value:V}),t}h(t,e);var r=t.prototype;return r.add=function(e){if(!g(this,S)[S]())return!1;var t=g(this,F)[F](e);this.listTarget.insertAdjacentHTML("beforeend",t),this.dispatch("added",{detail:{element:this.listTarget.lastElementChild,previousEvent:e}})},r.replace=function(e){if(!g(this,S)[S]())return!1;var t=e.detail.element,r=g(this,F)[F](e);t.insertAdjacentHTML("afterend",r);var i=t.nextElementSibling;t.remove(),this.dispatch("replaced",{detail:{element:i,previousEvent:e}})},r.remove=function(e){if(this.confirmRemoveValue&&!1===confirm("Are you sure?"))return!1;var t=e.target.closest("[data-nested-form-target='item']");"true"===t.dataset.newRecord?t.remove():(t.querySelector("input[name*='_destroy']").value=1,t.classList.add("hidden","destroying")),this.dispatch("removed")},t}(t.Controller);function V(e){return this.templateTargets.find(function(t){return t.dataset.templateName===e})||this.defaultTemplateTarget||this.templateTarget}function M(e){var t,r,i=g(this,T)[T]((null==e||null==(t=e.target)?void 0:t.value)||(null==e||null==(r=e.detail)?void 0:r.template)),n=Date.now()*Math.floor(100*Math.random());return i.innerHTML.replace(new RegExp(this.replaceKeyValue,"g"),n)}function C(){return!(this.hasMaxValue&&g(this,j)[j].length>=this.maxValue&&(console.warn("alert","Maximum allowed: "+this.maxValue),1))}function k(){return this.itemTargets.filter(function(e){return!e.classList.contains("destroying")})}P.targets=["list","item","template","defaultTemplate","message"],P.values={replaceKey:{type:String,default:"NEW_RECORD"},max:Number,min:Number,confirmRemove:Boolean};var A=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var r=t.prototype;return r.lock=function(){this.changeLockedValue(!0)},r.unlock=function(){this.changeLockedValue(!1)},r.toggle=function(){this.changeLockedValue(!this.lockedValue)},r.changeLockedValue=function(e){if(!this.checkWidth())return!1;this.lockedValue=e},r.lockedValueChanged=function(){document.documentElement.style.overflow=this.lockedValue?"hidden":null},r.checkWidth=function(){return!this.hasMaxWidthValue||window.matchMedia("(max-width: "+this.maxWidthValue+"px)").matches},t}(t.Controller);A.values={maxWidth:Number,locked:{type:Boolean,default:!1}};var O=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var r=t.prototype;return r.initialize=function(){var e={group:a.v4(),animation:150,filter:"input, button, select, textarea",ghostClass:"opacity-25",preventOnFilter:!1,forceFallback:!0};this.sortable=l.default.create(this.element,d({},d({},e,this.optionsValue),{onSort:this.onSort.bind(this)}))},r.update=function(){this.dispatch("update"),this.positionTargets.forEach(function(e,t){return e.value=t})},r.onSort=function(e){this.dispatch("sort",{detail:{event:e},cancelable:!0}).defaultPrevented||this.update()},t}(t.Controller);O.targets=["position"],O.values={options:Object};var E=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.connect=function(){u.default(this.element)},t}(t.Controller);e.ActivestorageAttachments=y,e.AutoForm=w,e.Details=x,e.NestedForm=P,e.ScrollLock=A,e.Sortable=O,e.TextareaAutosize=E});
//# sourceMappingURL=stimulus-components.umd.js.map
